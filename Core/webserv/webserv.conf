# Main Server Block - Default Configuration
server {
	listen 127.0.0.1:8010;
	server_name localhost;
	root assets/www;
	index index.html index.htm;
	
	# Timeout settings
	cgi_timeout 11;
	client_header_timeout 10;
	client_body_timeout 10;
	
	# Upload settings
	upload_dir assets/upload;
	client_max_body_size 2m;
	
	# Error pages
	error_page 400 assets/error_pages/400.html;
	error_page 403 assets/error_pages/403.html;
	error_page 404 assets/error_pages/404.html;
	error_page 405 assets/error_pages/405.html;
	error_page 413 assets/error_pages/413.html;
	error_page 500 assets/error_pages/500.html;
	
	# Default location
	location / {
		allowed_methods GET POST DELETE;
		autoindex off;
	}
	
	# Upload endpoint
	location /upload {
		allowed_methods POST DELETE;
		upload_enable on;
		upload_dir assets/upload/8010;
	}
	
	# CGI scripts
	location /cgi-bin/python {
		cgi_enable on;
		root assets/cgi-bin/python;
		allowed_methods GET POST DELETE;
		cgi_path assets/cgi-bin;
		cgi_ext .py .php .pl;
		cgi_pass /usr/bin/python3;
	}
	
	# Static files
	location /static {
		root assets/www;
		allowed_methods GET;
		autoindex on;
	}

	
	# Directory listing test
	location /files {
		root assets/www;
		allowed_methods GET;
		autoindex on;
	}
	
	# 301 redirect (permanent)
	location /old {
		return 301 /301.html;
	}

	# 302 redirect (temporary)
	location /old2 {
		return 302 /302.html;
	}

	location /forbidden {
		deny all;
	}

	# Different methods test
	location /methods-test {
		allowed_methods GET POST DELETE;
		autoindex off;
	}
}

# Second Server Block - Different Port (Required by subject)
server {
	listen 127.0.0.1:8011;
	server_name secondary.localhost localhost;
	root assets/www2;
	index index.html;
	
	client_max_body_size 5m;
	upload_dir assets/upload/8011;
	
	location / {
		allowed_methods GET POST DELETE;
		autoindex on;
	}
	
	location /images {
		root assets/www2/media;
		allowed_methods GET;
		autoindex on;
	}
	
	location /cgi {
		allowed_methods GET POST;
		cgi_path assets/cgi-bin;
		cgi_ext .py .pl;
	}
}

# Third Server Block - CGI Testing Server (Multiple CGI Types - BONUS)
server {
	listen 127.0.0.1:8012;
	server_name cgi-test.localhost localhost;
	root assets/www_cgi_test;
	client_max_body_size 10m;
	cgi_timeout 30;
	
	# Main page with links to all CGI tests
	location / {
		allowed_methods GET;
		autoindex off;
		index index.html;
	}
	
	# PHP CGI Testing
	location /php {
		root assets/cgi-bin/php;
		allowed_methods GET POST;
		cgi_enable on;
		cgi_ext .php;
		cgi_pass /usr/bin/php-cgi;
	}
	
	# Python CGI Testing
	location /python {
		root assets/cgi-bin/python;
		allowed_methods GET POST;
		cgi_enable on;
		cgi_ext .py;
		cgi_pass /usr/bin/python3;
	}
	
	# Perl CGI Testing (BONUS - Third CGI type)
	location /perl {
		root assets/cgi-bin/perl;
		allowed_methods GET POST;
		cgi_enable on;
		cgi_ext .pl;
		cgi_pass /usr/bin/perl;
	}
	
	# Mixed CGI location (all types in one directory)
	location /cgi-mixed {
		root assets/cgi-bin/mixed;
		allowed_methods GET POST;
		cgi_enable on;
		cgi_ext .php .py .pl;
		cgi_pass .php /usr/bin/php-cgi;
		cgi_pass .py /usr/bin/python3;
		cgi_pass .pl /usr/bin/perl;
	}
	
	# Form testing endpoint
	location /forms {
		root assets/www_cgi_test/forms;
		allowed_methods GET POST;
		autoindex off;
	}
}

# Server Block for Large File Testing
server {
	listen 127.0.0.1:8013;
	server_name method.localhost localhost;
	root assets/upload;
	client_max_body_size 60m;
	upload_dir assets/upload/filedump;
	
	location / {
		allowed_methods GET POST DELETE;
		upload_enable on;
		autoindex on;
	}
}

# Server Block for Dupe Testing
server {
	listen 127.0.0.1:8013;
	server_name dupe.localhost dupp.localhost;
	root assets/dupe;
	
	client_max_body_size 500m;
	upload_dir assets/upload/large;
	
	location / {
		allowed_methods GET POST;
		upload_enable on;
	}
}

# Session test Server Block
server {
	listen 127.0.0.1:8014;
	server_name session.localhost localhost;
	root assets/session;
	index index.html;

	location / {
		allowed_methods GET;
		autoindex off;
	}

	# All session API endpoints go to CGI
	location /session {
		allowed_methods GET POST;
		cgi_enable on;
		cgi_ext .py .php;
		cgi_path assets/session/cgi;
	}
}

# Error Testing Server (NEW - add this entire server block)
server {
	listen 127.0.0.1:8015;
	server_name error-test;
	root assets/www;
	index error-test.html;
	
	client_max_body_size 100k;  # Small limit to trigger 413 easily
	
	# Error pages
	error_page 400 assets/error_pages/400.html;
	error_page 403 assets/error_pages/403.html;
	error_page 404 assets/error_pages/404.html;
	error_page 405 assets/error_pages/405.html;
	error_page 408 assets/error_pages/408.html;
	error_page 413 assets/error_pages/413.html;
	error_page 500 assets/error_pages/500.html;
	error_page 501 assets/error_pages/501.html;
	error_page 504 assets/error_pages/504.html;
	error_page 505 assets/error_pages/505.html;
	
	# Default - only GET allowed (for 405 testing)
	location / {
		allowed_methods GET;
		autoindex off;
	}
	
	# Test location that only allows POST (405 on GET)
	location /post-only {
		allowed_methods POST;
		root assets/www/errors;
	}
	
	# Upload location with small body size
	location /upload-test {
		allowed_methods POST;
		upload_enable on;
		root assets/www;
		client_max_body_size 1048576;   # 1MB limit
	}

	# CGI for error testing
	location /error-cgi {
		cgi_enable on;
		root assets/cgi-bin/errors;
		allowed_methods GET POST;
		cgi_path /usr/bin;
	}
}
